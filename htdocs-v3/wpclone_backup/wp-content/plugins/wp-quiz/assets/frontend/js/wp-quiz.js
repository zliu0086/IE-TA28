"use strict";var _createClass=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(e,r){e.helpers=e.helpers||{},void 0===Object.values&&(Object.values=function(e){return Object.keys(e).map(function(t){return e[t]})}),e.helpers.loadEmbed=function(n,s){if(!n.hasClass("active")){var t={post_ID:0,type:"embed",shortcode:"[embed]"+s.url+"[/embed]",maxwidth:1e3},e=wp.ajax.post("parse-embed",t);e.done(function(t){var e=r(t.body);if(e.attr("width","100%"),e.attr("height","100%"),s.placeholder){var i=e.attr("src");e.attr("src",0<=i.indexOf("?")?i+"&autoplay=1":i+"?autoplay=1")}e.wrap('<div class="wq-embed-content"></div>').appendTo(n),n.addClass("active")}),e.fail(function(t){console.error(t.message)})}},e.helpers.getRequest=function(t){return t.beforeSend||(t.beforeSend=function(t){t.setRequestHeader("X-WP-Nonce",e.restNonce)}),t.method&&!t.type?t.type=t.method:!t.method&&t.type&&(t.method=t.type),r.ajax(t)},e.helpers.showLoading=function(t){var e=r(t);e.find(".wq-loading").length||(e.css("position","relative"),e.append('<div class="wq-loading"><span class="wq-icon wq-icon-spinner animate-spin wq-spinner"></span></div>')),e.addClass("wq-is-loading")},e.helpers.hideLoading=function(t){r(t).removeClass("wq-is-loading")},r.fn.extend({animateCss:function(t,e){var i=function(t){var e={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var i in e)if(void 0!==t.style[i])return e[i]}(document.createElement("div"));return this.addClass("animated "+t).one(i,function(){r(this).removeClass("animated "+t),"function"==typeof e&&e()}),this}}),e.Quiz=function(){function i(t,e){_classCallCheck(this,i),(this.$wrapper=t).data("wpQuiz",this),this.quizData=e,this.quizId=e.id,this.questions=e.questions?Object.values(e.questions):[],this.results=e.results?Object.values(e.results):[],this.settings=e.settings||{},this.shareUrl=e.shareUrl,this.currentQuestionIndex=0,this.totalQuestions=this.questions.length,this.lastQuestionIndex=this.totalQuestions-1,this.totalAnswered=0,this.totalCorrects=0,this.tracker={},this.resultId=null,this.result=null,this.isSavedPlayer=!1,this.points={},this.explanationDelay=5e3,this.loadCommonEvents(),this.loadEvents()}return _createClass(i,[{key:"isEmpty",value:function(t){return void 0===t||""===t||!1===t||0===t||""===t||{}===t||[]===t}},{key:"isShowPlayData",value:function(){return!this.isEmpty(this.quizData.playData)}},{key:"isShowNextButton",value:function(){return"off"!==this.settings.show_next_button}},{key:"isMultipleLayout",value:function(){return"multiple"===this.settings.question_layout}},{key:"showAnswered",value:function(){}},{key:"loadCommonEvents",value:function(){var e=this;this.$wrapper.on("click",".wq-embed-toggle-btn",function(t){return e.handleClickToggleEmbed(t)}),this.$wrapper.on("click",".wq-embed:not(.active)",function(t){if(t.currentTarget.querySelector("img")){var e=t.currentTarget.querySelector("iframe"),i=e.src;t.currentTarget.classList.add("active"),e&&(e.src=0<=i.indexOf("?")?i+"&autoplay=1":i+"?autoplay=1")}})}},{key:"loadEvents",value:function(){var e=this;this.$wrapper.on("click.answer",".wq-answer",function(t){return e.handleClickAnswer(t)}),this.$wrapper.on("click.nextQuestion",".wq-continue-btn",function(t){return e.handleClickNextQuestionButton(t)}),this.$wrapper.on("click.retakeQuiz",".wq-retake-quiz-btn",function(t){return e.handleClickRestartQuizButton(t)})}},{key:"handleClickAnswer",value:function(t){var e=r(t.currentTarget);if(!e.hasClass("chosen")){var i=e.closest(".wq-question");this.isAnswered(i)||(e.closest(".wq-answer").addClass("chosen"),this.isFullyAnswered(i)&&(i.addClass("wq_questionAnswered"),this.trackAnswer(i),this.totalAnswered++,this.currentQuestionIndex=parseInt(i.attr("data-index")),this.afterClickAnswer(e,i),this.nextQuestion()))}}},{key:"handleClickNextQuestionButton",value:function(t){t.preventDefault();var e=r(t.currentTarget).closest(".wq-question");this.showTheNextQuestion(e)}},{key:"handleClickRestartQuizButton",value:function(t){t.preventDefault(),this.restartQuiz()}},{key:"handleClickToggleEmbed",value:function(t){t.preventDefault(),r(t.currentTarget).parent().toggleClass("active").next().slideToggle("fast")}},{key:"handleClickBeginQuiz",value:function(t){var e=this;t.preventDefault(),this.$wrapper.find(".wq-quiz-intro-container").fadeOut("fast",function(){e.$wrapper.find(".wq-progress-bar-container, .wq-questions, .wq-embed-toggle, .wq_promoteQuizCtr").fadeIn("fast")})}},{key:"showTheNextQuestion",value:function(t){var n=this,e=function(i){i.animateCss(n.settings.animation_out,function(){var t=i.next(".wq-question"),e=i.offset().top;i.hide(),"on"===n.settings.auto_scroll&&r("html, body").animate({scrollTop:e-95}),t.show().animateCss(n.settings.animation_in)})};if(this.isAnswered(t)){if(this.totalAnswered<this.totalQuestions&&("trivia"!==this.quizData.type||this.isShowNextButton()?e(t):setTimeout(function(){e(t)},this.explanationDelay)),t.find(".wq-embed iframe").length){var i=t.find(".wq-embed iframe"),s=i.attr("src");i.attr("src",""),i.attr("src",s.replace("&autoplay=1",""))}t.find(".wq-question-video video").length&&t.find(".wq-question-video video")[0].player&&t.find(".wq-question-video video")[0].player.pause()}}},{key:"isFullyAnswered",value:function(t){return!0}},{key:"afterClickAnswer",value:function(t,e){if(this.isMultipleLayout())if(this.$wrapper.find(".wq_quizProgressBar").length&&this.updateProgressBar(),this.isShowNextButton()){var i=e.find(".wq_continue");this.totalAnswered<this.totalQuestions&&e.find(".wq_continue").length&&i.show()}else this.showTheNextQuestion(e)}},{key:"updateProgressBar",value:function(t){void 0===t&&(t=parseInt(100*this.totalAnswered/this.totalQuestions)),this.$wrapper.find(".wq_quizProgressValue").animate({width:t+"%"}).text(t+"%")}},{key:"nextQuestion",value:function(){return this.totalAnswered===this.totalQuestions?this.complete():this.currentQuestionIndex===this.lastQuestionIndex?(this.currentQuestionIndex=-1,this.nextQuestion()):(this.currentQuestionIndex++,this.isAnswered(this.currentQuestionIndex)?this.nextQuestion():void(this.isMultipleLayout()||"on"!==this.settings.auto_scroll||this.scrollToQuestion(this.currentQuestionIndex)))}},{key:"complete",value:function(){if(!this.isAnswerOnly){this.$wrapper.addClass("is-completed"),this.findResultId(),this.isSavedPlayer||(this.savePlayData(),this.isSavedPlayer=!0);this.$wrapper.find(".wq-force-action-container"),this.$wrapper.find('.wq-question[data-index="'+this.lastQuestionIndex+'"]');this.results.length&&this.showResult(),this.$wrapper.find(".wq-retake-quiz").length&&this.$wrapper.find(".wq-retake-quiz").show(),this.isMultipleLayout()||("on"===this.settings.end_answers?this.scrollToQuestion(0):this.results.length&&"on"===this.settings.auto_scroll&&this.scrollToResults()),this.$wrapper.trigger("wp_quiz_complete_quiz",[this])}}},{key:"findResultId",value:function(){}},{key:"trackAnswer",value:function(t){}},{key:"savePlayData",value:function(){}},{key:"showResult",value:function(){}},{key:"scrollToResults",value:function(){var t=this.$wrapper.find(".wq-force-action-container").length?this.$wrapper.find(".wq-force-action-container"):this.$wrapper.find(".wq-results");r("html, body").animate({scrollTop:t.offset().top-95})}},{key:"scrollToQuestion",value:function(t){r("html, body").animate({scrollTop:this.$wrapper.find('.wq-question[data-index="'+t+'"]').offset().top-95})}},{key:"scrollToQuiz",value:function(){r(window).scrollTop(r("#wp-quiz-"+this.quizId).offset().top-95)}},{key:"restartQuiz",value:function(){this.currentQuestionIndex=0,this.totalAnswered=0,this.totalCorrects=0,this.tracker={},this.isSavedPlayer=!1,this.isMultipleLayout()&&(this.$wrapper.find(".wq-question").hide(),this.$wrapper.find('.wq-question[data-index="0"]').show()),this.scrollToQuestion(0),this.updateProgressBar(),this.$wrapper.removeClass("is-completed"),this.$wrapper.removeClass("show-played"),this.$wrapper.find(".wq_questionAnswered").removeClass("wq_questionAnswered"),this.$wrapper.find(".is-correct").removeClass("is-correct"),this.$wrapper.find(".is-incorrect").removeClass("is-incorrect"),this.$wrapper.find(".chosen").removeClass("chosen"),this.$wrapper.find(".wq-question:not(.wq-is-ad) .wq_continue, .wq-results, .wq-result, .wq-retake-quiz").hide(),this.$wrapper.find(".wq-question").removeClass("force-show")}},{key:"isAnswered",value:function(t){return"function"==typeof t.hasClass?t.hasClass("wq_questionAnswered")||t.hasClass("wq-is-ad"):this.$wrapper.find('.wq-question[data-index="'+t+'"]').hasClass("wq_questionAnswered")}}]),i}(),r(document).ready(function(){r(document).on("click",".wq-share-fb",function(t){if("undefined"!=typeof FB){t.preventDefault();var e=t.currentTarget.dataset.url;if(t.currentTarget.dataset.trackingId){var i=t.currentTarget.dataset.trackingId;e=-1===e.indexOf("?")?e+"?wqtid="+i:e+"&wqtid="+i}else if(t.currentTarget.dataset.imageFile){var n=t.currentTarget.dataset.imageFile;e=-1===e.indexOf("?")?e+"?wqimg="+n:e+"&wqimg="+n}FB.ui({method:"share",href:e},function(t){console.log(t)})}}),r(document).on("click",".wq-share-tw",function(t){t.preventDefault();var e=t.currentTarget.dataset.url;if(t.currentTarget.dataset.trackingId){var i=t.currentTarget.dataset.trackingId;e=-1===e.indexOf("?")?e+"?wqtid="+i:e+"&wqtid="+i}else if(t.currentTarget.dataset.imageFile){var n=t.currentTarget.dataset.imageFile;e=-1===e.indexOf("?")?e+"?wqimg="+n:e+"&wqimg="+n}e="https://twitter.com/intent/tweet?url="+encodeURIComponent(e);var s=r(t.currentTarget).closest(".wq-quiz").find(".wq-result:visible .wq-result-score"),a=r(t.currentTarget).closest(".wq-quiz").find(".wq-result:visible .wq-result-title");s.length&&s.text()?e+="&text="+encodeURIComponent(s.text()):a.length&&a.text()&&(e+="&text="+encodeURIComponent(a.text())),window.open(e,"_blank","width=500, height=300")}),r(document).on("click",".wq-share-vk",function(t){t.preventDefault();var e=t.currentTarget.dataset.url;if(t.currentTarget.dataset.trackingId){var i=t.currentTarget.dataset.trackingId;e=-1===e.indexOf("?")?e+"?wqtid="+i:e+"&wqtid="+i}else if(t.currentTarget.dataset.imageFile){var n=t.currentTarget.dataset.imageFile;e=-1===e.indexOf("?")?e+"?wqimg="+n:e+"&wqimg="+n}window.open("http://vk.com/share.php?url="+encodeURIComponent(e),"_blank","width=500, height=300")}),r(document).on("click",".wq-question-hint-button",function(t){return t.stopPropagation(),t.preventDefault(),r(this).prev(".wq-question-hint-content").slideToggle(),!1}),r(document).on("click",".wq-question-hint-content",function(t){return t.stopPropagation()}),r(document).on("click",function(t){return r(".wq-question-hint-content").hide()})})}(wpQuiz,jQuery);